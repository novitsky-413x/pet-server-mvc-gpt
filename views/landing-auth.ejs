<%- include('includes/head.ejs') %>
</head>
<body>
    <%- include('includes/navigation.ejs') %>
    <main class="section">
        <div class="container">
            <section class="hero is-info">
                <div class="hero-body">
                    <p class="title">Welcome back</p>
                    <p class="subtitle">Start a new conversation or continue an existing one.</p>
                    <button id="startChat" class="button is-light">Start new chat</button>
                </div>
            </section>
        </div>
    </main>
    <script>
    (function(){
        const csrf = "<%= csrfToken %>";
        document.getElementById('startChat').addEventListener('click', async ()=>{
            try{
                const res = await fetch('/api/chats', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'CSRF-Token': csrf },
                    credentials: 'include',
                    body: JSON.stringify({})
                });
                const data = await res.json();
                if (data && data.item && data.item._id){
                    window.location.href = '/chat';
                } else {
                    window.location.href = '/chat';
                }
            } catch(e){
                window.location.href = '/chat';
            }
        });
    })();
    </script>
    <%- include('includes/end.ejs') %>
</body>
</html>


