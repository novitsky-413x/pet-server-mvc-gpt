<nav class="navbar" role="navigation" aria-label="main navigation">
    <div class="navbar-brand">
        <a class="navbar-item <%= path === '/' ? 'is-active active' : '' %>" href="/" <%= path === '/' ? 'aria-current="page"' : '' %>>Home</a>
        <a class="navbar-item <%= path === '/game' ? 'is-active active' : '' %>" href="/game" <%= path === '/game' ? 'aria-current="page"' : '' %>>Game</a>
        <% if (isAuthenticated) { %>
        <a class="navbar-item <%= path === '/chat' ? 'is-active active' : '' %>" href="/chat" <%= path === '/chat' ? 'aria-current="page"' : '' %>>Chat</a>
        <% } %>
        <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navMenu">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
    </div>
    <div id="navMenu" class="navbar-menu">
        <div class="navbar-end">
            <a id="themeToggle" class="navbar-item" role="button" title="Toggle theme">
                <span class="icon"><i class="fas fa-circle-half-stroke"></i></span>
            </a>
            <% if (!isAuthenticated) { %>
            <a class="navbar-item <%= path === '/login' ? 'is-active active' : '' %>" href="/login" <%= path === '/login' ? 'aria-current="page"' : '' %>>Login</a>
            <a class="navbar-item <%= path === '/signup' ? 'is-active active' : '' %>" href="/signup" <%= path === '/signup' ? 'aria-current="page"' : '' %>>Signup</a>
            <% } else { %>
            <div class="navbar-item">
                <form action="/logout" method="post">
                    <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
                    <button class="button is-light" type="submit">Logout</button>
                </form>
            </div>
            <% } %>
        </div>
    </div>
</nav>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const burger = document.querySelector('.navbar-burger');
        const menu = document.getElementById('navMenu');
        const toggle = document.getElementById('themeToggle');
        if (burger && menu) {
            burger.addEventListener('click', () => {
                burger.classList.toggle('is-active');
                menu.classList.toggle('is-active');
            });
        }
        if (toggle) {
            toggle.addEventListener('click', () => {
                const root = document.documentElement;
                const current = root.getAttribute('data-theme') || 'light';
                const next = current === 'light' ? 'dark' : 'light';
                root.setAttribute('data-theme', next);
                try { localStorage.setItem('theme', next); } catch(e) {}
                // Update hljs theme on toggle (call in next tick to ensure attribute applied)
                setTimeout(() => { try { if (window.updateHLTheme) window.updateHLTheme(); } catch(e) {} }, 0);
            });
        }
    });
</script>
